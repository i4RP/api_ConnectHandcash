"use strict";var A=Object.create;var S=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var N=(r,e)=>{for(var t in e)S(r,t,{get:e[t],enumerable:!0})},I=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of U(e))!B.call(r,s)&&s!==t&&S(r,s,{get:()=>e[s],enumerable:!(n=K(e,s))||n.enumerable});return r};var R=(r,e,t)=>(t=r!=null?A(H(r)):{},I(e||!r||!r.__esModule?S(t,"default",{value:r,enumerable:!0}):t,r)),D=r=>I(S({},"__esModule",{value:!0}),r);var $={};N($,{Environments:()=>c,HandCashConnect:()=>P,HandCashConnectApiError:()=>h,HandCashMinter:()=>v,HandCashOwner:()=>f,HandCashPurse:()=>y,Permissions:()=>L,Types:()=>k});module.exports=D($);var O=require("bsv-wasm"),b=R(require("crypto"),1);var q=R(require("axios"),1),w=require("bsv-wasm"),T=require("nanoid");var h=class extends Error{message;path;method;httpStatusCode;info;constructor(e){super(e.message),this.method=e.method,this.path=e.path,this.httpStatusCode=e.httpStatusCode,this.message=e.message,this.info=e.info,this.stack=e.stack}toString(){return JSON.stringify(this)}};var i=class r{privateKey;appSecret;appId;baseApiEndpoint;baseTrustholderEndpoint;constructor({authToken:e,appSecret:t,appId:n,baseApiEndpoint:s,baseTrustholderEndpoint:a}){if(e)try{this.privateKey=w.PrivateKey.from_hex(e)}catch{throw Error("Invalid authToken")}if(!n)throw Error("Missing appId");this.appSecret=t,this.appId=n,this.baseApiEndpoint=s,this.baseTrustholderEndpoint=a}getRequest(e,t,n={},s={}){let a=new Date().toISOString(),d=(0,T.nanoid)(),u=JSON.stringify(n)==="{}"?"":JSON.stringify(n),E=r.getEncodedEndpoint(t,s),m={"app-id":this.appId,...this.appSecret&&{"app-secret":this.appSecret},consumer:"connect-sdk"};if(this.privateKey){let x=this.privateKey.to_public_key();m["oauth-publickey"]=x.to_hex(),m["oauth-timestamp"]=a.toString(),m["oauth-nonce"]=d,m["oauth-signature"]=r.getRequestSignature(e,E,u,a,this.privateKey,d)}return{baseURL:this.baseApiEndpoint,url:E,method:e,headers:m,data:u,responseType:"json"}}getTrustholderRequest(e,t,n,s={}){let a=r.getEncodedEndpoint(t,s);return{baseURL:this.baseTrustholderEndpoint,url:a,method:e,headers:{},data:n,responseType:"json"}}static getEncodedEndpoint(e,t){return q.default.getUri({url:e,params:t})}static getRequestSignature(e,t,n,s,a,d){let u=r.getRequestSignaturePayload(e,t,n,s,d);return a.sign_message(Buffer.from(u)).to_der_hex()}static getRequestSignaturePayload(e,t,n,s,a){return`${e}
${t}
${s}
${n}${a?`
${a}`:""}`}async getCurrentProfile(){let e=this.getRequest("GET","/v1/connect/profile/currentUserProfile");return r.handleRequest(e,new Error().stack)}async getPublicProfilesByHandle(e){let t=e.map((s,a)=>[`aliases[${a}]`,s]),n=this.getRequest("GET","/v1/connect/profile/publicUserProfiles",{},{...Object.fromEntries(t)});return r.handleRequest(n,new Error().stack)}async getUserPermissions(){let e=this.getRequest("GET","/v1/connect/profile/permissions");return r.handleRequest(e,new Error().stack)}async getEncryptionKeypair(e){let t=this.getRequest("GET","/v1/connect/profile/encryptionKeypair",{},{encryptionPublicKey:e});return r.handleRequest(t,new Error().stack)}async signData(e){let t=this.getRequest("POST","/v1/connect/profile/signData",{format:e.format,value:e.value});return r.handleRequest(t,new Error().stack)}async getUserFriends(){let e=this.getRequest("GET","/v1/connect/profile/friends");return r.handleRequest(e,new Error().stack)}async getSpendableBalance(e){let t=this.getRequest("GET","/v1/connect/wallet/spendableBalance",{},e?{currencyCode:e}:{});return r.handleRequest(t,new Error().stack)}async getTotalBalance(){let e=this.getRequest("GET","/v1/connect/wallet/balance");return r.handleRequest(e,new Error().stack)}async pay(e){let t=this.getRequest("POST","/v1/connect/wallet/pay",{description:e.description,appAction:e.appAction,receivers:e.payments,attachment:e.attachment});return r.handleRequest(t,new Error().stack)}async payPaymentRequest(e){let t=this.getRequest("POST","/v3/wallet/transactions/send/paymentRequest",{paymentRequestId:e});return r.handleRequest(t,new Error().stack)}async getPayment(e){let t=this.getRequest("GET","/v1/connect/wallet/payment",{},{transactionId:e});return r.handleRequest(t,new Error().stack)}async getExchangeRate(e){let t=this.getRequest("GET",`/v1/connect/wallet/exchangeRate/${e}`);return r.handleRequest(t,new Error().stack)}async pursePay(e,t){let n=this.getRequest("POST","/v1/connect/runExtension/purse/pay",{rawTransaction:e,inputParents:t});return r.handleRequest(n,new Error().stack)}async purseBroadcast(e){let t=this.getRequest("POST","/v1/connect/runExtension/purse/broadcast",{rawTransaction:e});return r.handleRequest(t,new Error().stack)}async ownerNextAddress(e){let t=this.getRequest("GET","/v1/connect/runExtension/owner/next",{},{alias:e});return r.handleRequest(t,new Error().stack)}async ownerSign(e,t,n){let s=this.getRequest("POST","/v1/connect/runExtension/owner/sign",{rawTransaction:e,inputParents:t,locks:n});return r.handleRequest(s,new Error().stack)}async getNftLocations(){let e=this.getRequest("GET","/v1/connect/runExtension/owner/nftLocations");return r.handleRequest(e,new Error().stack)}async requestEmailCode(e,t){let n=this.getRequest("POST","/v1/connect/account/requestEmailCode",{email:e,customEmailParameters:t});return(await r.handleRequest(n,new Error().stack)).requestId.requestId}async verifyEmailCode(e,t,n){let s=this.getTrustholderRequest("POST","/auth/verifyCode",{requestId:e,verificationCode:t,publicKey:n});return r.handleRequest(s,new Error().stack)}async createNewAccount(e,t,n){let s=this.getRequest("POST","/v1/connect/account",{accessPublicKey:e,email:t,referrerAlias:n});return r.handleRequest(s,new Error().stack)}async getItemsInventory(e){let t=this.getRequest("POST","/v3/wallet/items/inventory",e);return r.handleRequest(t,new Error().stack)}async getItemListings(e){let t={...e,onlyUserListings:!0},n=this.getRequest("POST","/v3/itemListing/list",t);return r.handleRequest(n,new Error().stack)}async createOrder(e){let t=this.getRequest("POST","/v3/itemCreationOrder",e);return r.handleRequest(t,new Error().stack)}async getCreateItemsOrder(e){let t=this.getRequest("GET",`/v3/itemCreationOrder/${e}`);return r.handleRequest(t,new Error().stack)}async getItemsByOrder(e){let t=this.getRequest("GET",`/v3/itemCreationOrder/${e}/items`);return r.handleRequest(t,new Error().stack)}async addOrderItems({orderId:e,items:t,itemCreationOrderType:n}){let s=this.getRequest("POST",`/v3/itemCreationOrder/${e}/add`,{items:t,itemCreationOrderType:n});return r.handleRequest(s,new Error().stack)}async create(e){let t=this.getRequest("POST","/v3/itemCreationOrder/issueItems",e);return r.handleRequest(t,new Error().stack)}async commitOrder(e){let t=this.getRequest("POST",`/v3/itemCreationOrder/${e}/commit`);return r.handleRequest(t,new Error().stack)}async inscribeNextBatch(e){let t=this.getRequest("POST","/v3/itemCreationOrder/createBatch",{itemCreationOrderId:e});return r.handleRequest(t,new Error().stack)}async transferItems(e){let t=this.getRequest("POST","/v3/wallet/items/send",e);return r.handleRequest(t,new Error().stack)}static async handleRequest(e,t){try{return(await(0,q.default)(e)).data}catch(n){throw r.handleApiError({...n,stack:t})}}static handleApiError(e){return e instanceof Error?e:new h({method:e.request.method,path:e.request.path,httpStatusCode:e.response.status,message:e.response.data.message,info:e.response.data.info,stack:e.stack})}};var p=class{handCashConnectService;constructor(e){this.handCashConnectService=e}async getSpendableBalance(e){return this.handCashConnectService.getSpendableBalance(e)}async getTotalBalance(){return this.handCashConnectService.getTotalBalance()}async pay(e){return this.handCashConnectService.pay(e)}async getPayment(e){return this.handCashConnectService.getPayment(e)}async getExchangeRate(e){return this.handCashConnectService.getExchangeRate(e)}};var o=require("bsv-wasm"),l=class{handCashConnectService;constructor(e){this.handCashConnectService=e}async getCurrentProfile(){return this.handCashConnectService.getCurrentProfile()}async getPublicProfilesByHandle(e){return this.handCashConnectService.getPublicProfilesByHandle(e).then(t=>t.items)}async getFriends(){return this.handCashConnectService.getUserFriends().then(e=>e.items)}async getPermissions(){return this.handCashConnectService.getUserPermissions().then(e=>e.items)}async getPermissionsInfo(){return this.handCashConnectService.getUserPermissions().then(e=>e)}async getEncryptionKeypair(){let e=o.PrivateKey.from_random(),t=await this.handCashConnectService.getEncryptionKeypair(e.to_public_key().to_hex()),n=o.PublicKey.from_hex(t.senderPublicKeyHex);return{publicKey:Buffer.from(o.ECIES.decrypt(o.ECIESCiphertext.from_bytes(Buffer.from(t.encryptedPublicKeyHex,"hex"),!0),e,n)).toString(),privateKey:Buffer.from(o.ECIES.decrypt(o.ECIESCiphertext.from_bytes(Buffer.from(t.encryptedPrivateKeyHex,"hex"),!0),e,n)).toString()}}async signData(e){return this.handCashConnectService.signData(e)}};var g=class{handCashConnectService;constructor(e){this.handCashConnectService=e}async getItemsInventory(e){return this.handCashConnectService.getItemsInventory(e).then(t=>t.items)}async getItemListings(e){return this.handCashConnectService.getItemListings(e).then(t=>t.items)}async transfer(e){return this.handCashConnectService.transferItems(e)}};var C=class r{wallet;profile;items;constructor(e,t,n){this.wallet=e,this.profile=t,this.items=n}static fromAuthToken({authToken:e,appSecret:t,appId:n,baseApiEndpoint:s,baseTrustholderEndpoint:a}){if(!t)throw Error("Missing appSecret");let d=new i({authToken:e,baseApiEndpoint:s,baseTrustholderEndpoint:a,appSecret:t,appId:n}),u=new p(d),E=new l(d),m=new g(d);return new r(u,E,m)}};var G={prod:{apiEndpoint:"https://cloud.handcash.io",clientUrl:"https://app.handcash.io",trustholderEndpoint:"https://trust.hastearcade.com",cloudinary:{apiKey:"544588249773336",cloudName:"hn8pdtayf",uploadPreset:"ml_items"}},beta:{apiEndpoint:"https://beta-cloud.handcash.io",clientUrl:"https://beta-app.handcash.io",trustholderEndpoint:"https://trust.dev.hastearcade.com",cloudinary:{apiKey:"882244126343337",cloudName:"handcash-iae",uploadPreset:"ml_items"}},iae:{apiEndpoint:"https://iae.cloud.handcash.io",clientUrl:"https://iae-app.handcash.io",trustholderEndpoint:"http://trustholder-service-iae.us-east-1.elasticbeanstalk.com",cloudinary:{apiKey:"882244126343337",cloudName:"handcash-iae",uploadPreset:"ml_items"}}},c=G;var P=class{appId;appSecret;handCashConnectService;env;constructor({appId:e,appSecret:t,env:n=c.prod}){this.appId=e,this.appSecret=t,this.env=n,this.handCashConnectService=new i({appId:this.appId,appSecret:this.appSecret,baseApiEndpoint:this.env.apiEndpoint,baseTrustholderEndpoint:this.env.trustholderEndpoint})}getRedirectionUrl(e={}){e.appId=this.appId;let t=Object.entries(e).map(([n,s])=>`${encodeURIComponent(n)}=${encodeURIComponent(s.toString())}`).join("&");return`${this.env.clientUrl}/#/authorizeApp?${t}`}getChangeSpendLimitsUrl(e){return`${this.env.clientUrl}/#/settings/spendLimits`+(e?`?redirectUrl=${e}`:"")}generateAuthenticationKeyPair=()=>{let e=O.PrivateKey.from_random(),t=e.to_public_key();return{privateKey:e.to_hex(),publicKey:t.to_hex()}};requestEmailCode(e,t){return this.handCashConnectService.requestEmailCode(e,t)}verifyEmailCode(e,t,n){return this.handCashConnectService.verifyEmailCode(e,t,n)}createNewAccount(e,t,n){return this.handCashConnectService.createNewAccount(e,t,n)}getAccountFromAuthToken(e){return C.fromAuthToken({authToken:e,appSecret:this.appSecret,appId:this.appId,baseApiEndpoint:this.env.apiEndpoint,baseTrustholderEndpoint:this.env.trustholderEndpoint})}getWebhookEvent=(e,t)=>{if(!e)throw new Error("No signature provided");let n=new Date(new Date().getTime()-5*6e4);if(new Date(t.created)<n)throw new Error("Timestamp is too old");let s=b.default.createHmac("sha256",this.appSecret);if(s.update(JSON.stringify(t)),s.digest("hex")!==e)throw new Error("Invalid signature");switch(t.event){case"item_listing_payment_completed":return t;case"items_transferred":return t;default:throw new Error(`Unknown event type: ${t.event}`)}}};var y=class r{handCashConnectService;constructor(e){this.handCashConnectService=e}static fromAuthToken(e,t=c.prod,n="",s=""){let a=new i({authToken:e,baseApiEndpoint:t.apiEndpoint,baseTrustholderEndpoint:t.trustholderEndpoint,appSecret:n,appId:s});return new r(a)}async pay(e,t){return(await this.handCashConnectService.pursePay(e,t)).partiallySignedTx}async broadcast(e){await this.handCashConnectService.purseBroadcast(e)}};var f=class r{handCashConnectService;constructor(e){this.handCashConnectService=e}static fromAuthToken(e,t=c.prod,n="",s=""){let a=new i({authToken:e,baseApiEndpoint:t.apiEndpoint,baseTrustholderEndpoint:t.trustholderEndpoint,appSecret:n,appId:s});return new r(a)}async nextOwner(e){return(await this.handCashConnectService.ownerNextAddress(e)).ownerAddress}async sign(e,t,n){return(await this.handCashConnectService.ownerSign(e,t,n)).signedTransaction}async getNftLocations(){return(await this.handCashConnectService.getNftLocations()).nftLocations}};var v=class r{handCashConnectService;static fromAppCredentials(e){let t=e.env||c.prod;return new r({handCashConnectService:new i({appId:e.appId,appSecret:"",authToken:e.authToken,baseApiEndpoint:t.apiEndpoint,baseTrustholderEndpoint:t.trustholderEndpoint})})}constructor({handCashConnectService:e}){this.handCashConnectService=e}async createItemsOrder(e){return this.handCashConnectService.create({items:e.items,itemCreationOrderType:"collectionItem",referencedCollection:e.collectionId})}async createCollectionOrder(e){return this.handCashConnectService.create({items:[e],itemCreationOrderType:"collection"})}createCollectionItemsOrder(e){return this.handCashConnectService.createOrder({items:[],itemCreationOrderType:"collectionItem",referencedCollection:e})}async addOrderItems(e){return this.handCashConnectService.addOrderItems(e)}commitOrder(e){return this.handCashConnectService.commitOrder(e)}inscribeNextBatch(e){return this.handCashConnectService.inscribeNextBatch(e)}getOrder(e){return this.handCashConnectService.getCreateItemsOrder(e)}getOrderItems(e){return this.handCashConnectService.getItemsByOrder(e).then(t=>t.items)}payPaymentRequest(e){return this.handCashConnectService.payPaymentRequest(e)}};var k={};var L={Pay:"PAY",UserPublicProfile:"USER_PUBLIC_PROFILE",UserPrivateProfile:"USER_PRIVATE_PROFILE",Friends:"FRIENDS",Decryption:"DECRYPTION",SignData:"SIGN_DATA",ReadBalance:"READ_BALANCE"};0&&(module.exports={Environments,HandCashConnect,HandCashConnectApiError,HandCashMinter,HandCashOwner,HandCashPurse,Permissions,Types});
